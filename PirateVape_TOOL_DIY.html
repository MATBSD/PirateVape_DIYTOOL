<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PirateVape - Gestionnaire DIY Complet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Syst√®me d'onglets */
        .tabs-container {
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 5px;
            backdrop-filter: blur(10px);
            gap: 5px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab.active {
            background: rgba(255, 255, 255, 0.95);
            color: #4a5568;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .card h2 {
            color: #4a5568;
            margin-bottom: 25px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .ingredient-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
            padding: 8px 12px;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .recipe-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .recipe-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .recipe-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
            color: #666;
        }

        .ingredients-list {
            background: rgba(102, 126, 234, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .ingredients-list h4 {
            margin-bottom: 10px;
            color: #4a5568;
        }

        .calculation-results {
            background: rgba(76, 175, 80, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .calculation-results h3 {
            color: #388e3c;
            margin-bottom: 15px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .result-item .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .result-item .label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .nicotine-section {
            background: rgba(255, 193, 7, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .nicotine-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .toggle-btn {
            background: #e2e8f0;
            color: #4a5568;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        /* Styles pour le gestionnaire de stock */
        .stock-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .stock-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .stock-table th,
        .stock-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .stock-table th {
            background: rgba(102, 126, 234, 0.1);
            font-weight: 600;
            color: #4a5568;
        }

        .stock-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .quantity-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .quantity-high {
            background: rgba(76, 175, 80, 0.2);
            color: #388e3c;
        }

        .quantity-medium {
            background: rgba(255, 193, 7, 0.2);
            color: #f57c00;
        }

        .quantity-low {
            background: rgba(244, 67, 54, 0.2);
            color: #d32f2f;
        }

        /* Styles pour le Steep Tool */
        .steep-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .steep-header {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .steep-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-100px) translateY(-100px); }
        }

        .steep-header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .steep-header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 20px;
        }

        .nav-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .current-month {
            font-size: 1.5em;
            font-weight: 700;
            color: #333;
            text-align: center;
            min-width: 200px;
        }

        .add-recipe-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            margin: 0 5px;
        }

        .add-recipe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .add-recipe-btn.blue {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .add-recipe-btn.blue:hover {
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            margin: 0 20px;
            border-radius: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 10px;
        }

        .legend-color.steeping {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .legend-color.ready {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .day-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 10px;
            text-align: center;
            font-weight: 700;
            font-size: 1.1em;
        }

        .day {
            background: white;
            min-height: 120px;
            padding: 10px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .day:hover {
            background: #f8f9fa;
            transform: scale(1.02);
        }

        .day.other-month {
            background: #f5f5f5;
            color: #999;
        }

        .day.today {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .day-number {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .recipe {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px 0;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .recipe.ready {
            background: linear-gradient(135deg, #00b894, #00a085);
            animation: pulse 2s infinite;
        }

        .recipe.steeping {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 184, 148, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); }
        }

        .recipe:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
            transition: color 0.3s;
        }

        .close:hover {
            color: #333;
        }

        .submit-btn {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.3);
        }

        .recipe-details {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .delete-btn {
            background: linear-gradient(135deg, #e17055, #d63031);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: scale(1.05);
        }

        .recipe-action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        /* Steeping Modal Styles */
        .steep-modal {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            max-width: 400px;
        }

        .steep-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .steep-option:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .steep-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .ingredient-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nicotine-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .stock-filters {
                flex-direction: column;
            }

            .controls {
                flex-direction: column;
                text-align: center;
            }

            .nav-buttons {
                order: 2;
            }

            .current-month {
                order: 1;
                margin-bottom: 10px;
            }

            .add-recipe-btn {
                order: 3;
                margin-top: 10px;
            }

            .calendar {
                margin: 10px;
            }

            .day {
                min-height: 80px;
                padding: 5px;
            }

            .steep-header h1 {
                font-size: 2em;
            }
        }

        .icon {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ PirateVape - Gestionnaire DIY Complet</h1>
            <p>Cr√©ez vos recettes, g√©rez votre stock et planifiez votre steep avec pr√©cision</p>
        </div>

        <!-- Syst√®me d'onglets -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab(this, 'recipes')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    Gestionnaire de Recettes
                </button>
                <button class="tab" onclick="switchTab(this, 'stock')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M20 7h-3V6a4 4 0 0 0-4-4h-2a4 4 0 0 0-4 4v1H4a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3V9h1a1 1 0 0 0 0-2zM9 6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1H9V6zm8 16a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V9h10v13z"/></svg>
                    Gestionnaire de Stock
                </button>
                <button class="tab" onclick="switchTab(this, 'steep')">
                    <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    Planificateur de Steep
                </button>
            </div>
        </div>

        <!-- Contenu de l'onglet Recettes -->
        <div id="recipes-tab" class="tab-content active">
            <div class="main-grid">
                <!-- Cr√©ation de recette -->
                <div class="card">
                    <h2>
                        <svg class="icon" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                        Nouvelle Recette
                    </h2>
                    
                    <form id="recipeForm">
                        <div class="form-group">
                            <label for="recipeName">Nom de la recette</label>
                            <input type="text" id="recipeName" required>
                        </div>

                        <div class="form-group">
                            <label for="recipeDescription">Description (optionnel)</label>
                            <textarea id="recipeDescription" rows="3"></textarea>
                        </div>

                        <div class="nicotine-section">
                            <h3>Configuration</h3>
                            <div class="nicotine-grid">
                                <div class="form-group">
                                    <label for="desiredNicotine">Taux nicotine d√©sir√© (mg/ml)</label>
                                    <input type="number" id="desiredNicotine" step="0.1" min="0" value="3">
                                </div>
                                <div class="form-group">
                                    <label for="nicotineStrength">Force base nicotin√©e (mg/ml)</label>
                                    <input type="number" id="nicotineStrength" step="0.1" min="0" value="20">
                                </div>
                                <div class="form-group">
                                    <label for="targetVolume">Volume total d√©sir√© (ml)</label>
                                    <input type="number" id="targetVolume" step="0.1" min="0" value="30">
                                </div>
                            </div>
                            <div style="background: rgba(255,255,255,0.7); padding: 15px; border-radius: 10px; margin-top: 15px;">
                                <p><strong>‚ÑπÔ∏è Informations :</strong></p>
                                <p>‚Ä¢ Nicotine : Full PG (1.036 g/ml)</p>
                                <p>‚Ä¢ Ar√¥mes : Full PG (1.036 g/ml)</p>
                                <p>‚Ä¢ Base neutre : Full VG (1.22 g/ml)</p>
                            </div>
                        </div>

                        <h3>Ar√¥mes</h3>
                        <div id="ingredients">
                            <div class="ingredient-row">
                                <div class="form-group">
                                    <label>Nom de l'ar√¥me</label>
                                    <input type="text" class="ingredient-name" placeholder="Ex: Fraise, Vanille, Menthe..." required>
                                </div>
                                <div class="form-group">
                                    <label>Pourcentage (%)</label>
                                    <input type="number" class="ingredient-percentage" step="0.1" min="0" max="100" required>
                                </div>
                                <div class="form-group">
                                    <label>Type</label>
                                    <select class="ingredient-type" onchange="updateDensity(this)">
                                        <option value="arome" selected>Ar√¥me (PG)</option>
                                        <option value="vg">Base VG</option>
                                        <option value="pg">Base PG</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Densit√© (g/ml)</label>
                                    <input type="number" class="ingredient-density" step="0.001" min="0" value="1.036" readonly>
                                </div>
                                <button type="button" class="btn btn-danger" onclick="removeIngredient(this)">√ó</button>
                            </div>
                        </div>

                        <button type="button" class="btn btn-secondary" onclick="addIngredient()">
                            + Ajouter un ingr√©dient
                        </button>

                        <div style="margin-top: 20px;">
                            <button type="button" class="btn btn-primary" onclick="calculateRecipe()">
                                üßÆ Calculer la recette
                            </button>
                            <button type="submit" class="btn btn-primary">
                                üíæ Sauvegarder
                            </button>
                        </div>
                    </form>

                    <div id="calculationResults"></div>
                </div>

                <!-- Liste des recettes -->
                <div class="card">
                    <h2>
                        <svg class="icon" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
                        Mes Recettes
                    </h2>
                    
                    <div class="form-group">
                        <input type="text" id="searchRecipes" placeholder="Rechercher une recette...">
                    </div>

                    <div>
                        <button class="toggle-btn active" onclick="filterRecipes('all', this)">Toutes</button>
                        <button class="toggle-btn" onclick="filterRecipes('recent', this)">R√©centes</button>
                        <button class="toggle-btn" onclick="filterRecipes('favorites', this)">Favoris</button>
                    </div>

                    <div style="margin-top: 10px;">
                        <button class="btn btn-secondary" onclick="exportRecipes()">‚¨áÔ∏è Exporter les recettes</button>
                        <label class="btn btn-secondary" style="cursor: pointer;">
                            ‚¨ÜÔ∏è Importer
                            <input type="file" accept=".json" style="display: none;" onchange="importRecipes(event)">
                        </label>
                    </div>

                    <div id="recipesList" class="recipes-grid"></div>
                </div>
            </div>
        </div>

        <!-- Contenu de l'onglet Stock -->
        <div id="stock-tab" class="tab-content">
            <div class="main-grid">
                <!-- Ajout d'ar√¥me -->
                <div class="card">
                    <h2>
                        <svg class="icon" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                        Ajouter un Ar√¥me
                    </h2>
                    
                    <form id="aromaForm">
                        <div class="form-group">
                            <label for="aromaName">Nom de l'ar√¥me</label>
                            <input type="text" id="aromaName" placeholder="Ex: Fraise, Vanille..." required>
                        </div>

                        <div class="form-group">
                            <label for="aromaBrand">Marque</label>
                            <input type="text" id="aromaBrand" placeholder="Ex: Capella, TPA..." required>
                        </div>

                        <div class="form-group">
                            <label for="aromaType">Type d'ar√¥me</label>
                            <select id="aromaType" required>
                                <option value="">S√©lectionner un type</option>
                                <option value="Fruit√©">Fruit√©</option>
                                <option value="Gourmand">Gourmand</option>
                                <option value="Menthol√©">Menthol√©</option>
                                <option value="Tabac">Tabac</option>
                                <option value="Additif">Additif</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="aromaQuantity">Quantit√© (ml)</label>
                            <input type="number" id="aromaQuantity" step="0.1" min="0" required>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            ‚ûï Ajouter √† mon stock
                        </button>
                    </form>
                </div>

                <!-- Gestion du stock -->
                <div class="card">
                    <h2>
                        <svg class="icon" viewBox="0 0 24 24"><path d="M20 7h-3V6a4 4 0 0 0-4-4h-2a4 4 0 0 0-4 4v1H4a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h8a3 3 0 0 0 3-3V9h1a1 1 0 0 0 0-2zM9 6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1H9V6zm8 16a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V9h10v13z"/></svg>
                        Gestion du Stock
                    </h2>

                    <div class="stock-filters">
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 200px;">
                            <input type="text" id="searchName" placeholder="Rechercher par nom...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0; flex: 1; min-width: 150px;">
                            <select id="filterType">
                                <option value="">Tous les types</option>
                                <option value="Fruit√©">Fruit√©</option>
                                <option value="Gourmand">Gourmand</option>
                                <option value="Menthol√©">Menthol√©</option>
                                <option value="Tabac">Tabac</option>
                                <option value="Additif">Additif</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary" onclick="sortByQuantity()">
                            üìä Trier par quantit√©
                        </button>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <button class="btn btn-success" onclick="exportStockData()">‚¨áÔ∏è Exporter le stock</button>
                        <label class="btn btn-warning" style="cursor: pointer;">
                            ‚¨ÜÔ∏è Importer le stock
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importStockData(event)">
                        </label>
                    </div>

                    <div id="stockStats" class="result-grid" style="margin-bottom: 20px;"></div>
                </div>
            </div>

            <!-- Tableau du stock -->
            <div class="table-container">
                <h3 style="color: #4a5568; margin-bottom: 15px;">üì¶ Stock Actuel</h3>
                <table class="stock-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Marque</th>
                            <th>Type</th>
                            <th>Quantit√©</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="aromaTable"></tbody>
                </table>
                <div id="noAromas" style="text-align: center; padding: 40px; color: #666; display: none;">
                    <p>Aucun ar√¥me dans votre stock</p>
                </div>
            </div>
        </div>

        <!-- Contenu de l'onglet Steep -->
        <div id="steep-tab" class="tab-content">
            <div class="steep-container">
                <div class="steep-header">
                    <h1>üß™ Steep Planner</h1>
                    <p>G√©rez vos recettes d'e-liquides avec style</p>
                </div>

                <div class="controls">
                    <div class="nav-buttons">
                        <button class="nav-btn" id="prevBtn">‚Üê Pr√©c√©dent</button>
                        <button class="nav-btn" id="nextBtn">Suivant ‚Üí</button>
                    </div>
                    <div class="current-month" id="currentMonth"></div>
                    <div>
                        <button class="add-recipe-btn" id="addSteepRecipeBtn">+ Nouvelle Recette</button>
                        <button class="add-recipe-btn blue" id="viewSteepRecipesBtn">üìã Mes Recettes</button>
                    </div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color steeping"></div>
                        <span>En cours de steep</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color ready"></div>
                        <span>Pr√™te √† vaper!</span>
                    </div>
                </div>

                <div class="calendar" id="calendar"></div>
            </div>
        </div>
    </div>

    <!-- Modal pour ajouter une recette de steep -->
    <div id="steepModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeSteepModalBtn">&times;</span>
            <h2>Nouvelle Recette E-Liquide pour Steep</h2>
            <div class="form-group">
                <label for="steepRecipeName">Nom de la recette:</label>
                <input type="text" id="steepRecipeName" placeholder="Ex: Vanille Custard" required>
            </div>
            <div class="form-group">
                <label for="steepDuration">Dur√©e de steep (jours):</label>
                <select id="steepDuration" required>
                    <option value="3">3 jours</option>
                    <option value="7">1 semaine</option>
                    <option value="14" selected>2 semaines</option>
                    <option value="21">3 semaines</option>
                    <option value="30">1 mois</option>
                    <option value="60">2 mois</option>
                    <option value="90">3 mois</option>
                </select>
            </div>
            <div class="form-group">
                <label for="steepRecipeDate">Date de cr√©ation:</label>
                <input type="date" id="steepRecipeDate" required>
            </div>
            <button type="button" class="submit-btn" id="submitSteepRecipeBtn">üß™ Ajouter la Recette</button>
        </div>
    </div>

    <!-- Modal pour la liste des recettes de steep -->
    <div id="steepRecipesListModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeSteepRecipesModalBtn">&times;</span>
            <div id="steepRecipesListContent"></div>
        </div>
    </div>

    <!-- Modal pour ajouter au steep depuis une recette -->
    <div id="addToSteepModal" class="modal">
        <div class="modal-content steep-modal">
            <span class="close" id="closeAddToSteepModalBtn">&times;</span>
            <h2>üß™ Ajouter au Calendrier de Steep</h2>
            <p><strong id="selectedRecipeName"></strong></p>
            
            <div class="form-group">
                <label for="steepDateChoice">Date de cr√©ation:</label>
                <input type="date" id="steepDateChoice" required>
            </div>

            <div class="form-group">
                <label>Choisissez la dur√©e de steep:</label>
                <div id="steepOptions">
                    <div class="steep-option" data-days="3">
                        <span>üöÄ Rapid Steep</span>
                        <span>3 jours</span>
                    </div>
                    <div class="steep-option" data-days="7">
                        <span>‚ö° Quick Steep</span>
                        <span>1 semaine</span>
                    </div>
                    <div class="steep-option selected" data-days="14">
                        <span>üß™ Standard Steep</span>
                        <span>2 semaines</span>
                    </div>
                    <div class="steep-option" data-days="21">
                        <span>‚è≥ Long Steep</span>
                        <span>3 semaines</span>
                    </div>
                    <div class="steep-option" data-days="30">
                        <span>üè∫ Premium Steep</span>
                        <span>1 mois</span>
                    </div>
                    <div class="steep-option" data-days="60">
                        <span>üç∑ Vintage Steep</span>
                        <span>2 mois</span>
                    </div>
                    <div class="steep-option" data-days="90">
                        <span>üíé Ultra Premium</span>
                        <span>3 mois</span>
                    </div>
                </div>
            </div>

            <button type="button" class="submit-btn" id="confirmAddToSteepBtn">üìÖ Ajouter au Calendrier</button>
        </div>
    </div>

    <script>
        // ===== VARIABLES GLOBALES =====
        const DENSITIES = {
            'arome': 1.036,
            'vg': 1.22,
            'pg': 1.036,
            'nicotine': 1.036,
        };

        let recipes = JSON.parse(localStorage.getItem('eliquid-recipes') || '[]');
        let currentFilter = 'all';
        let aromas = JSON.parse(localStorage.getItem('aromas') || '[]');
        let sortAsc = true;

        // Variables pour le Steep Tool
        let currentDate = new Date();
        let steepRecipes = JSON.parse(localStorage.getItem('steepRecipes') || '[]');
        let selectedRecipeForSteep = null;
        let selectedSteepDuration = 14;

        const monthNames = [
            'Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'
        ];

        const dayNames = ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'];

        // ===== SYST√àME D'ONGLETS =====
        function switchTab(button, tabName) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Activer l'onglet cliqu√©
            button.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Initialiser le contenu selon l'onglet
            if (tabName === 'stock') {
                renderStockTable();
                updateStockStats();
            } else if (tabName === 'steep') {
                generateCalendar();
            }
        }

        // ===== GESTIONNAIRE DE RECETTES =====
        function updateDensity(selectElement) {
            const densityInput = selectElement.parentElement.parentElement.querySelector('.ingredient-density');
            const selectedType = selectElement.value;
            
            if (DENSITIES[selectedType]) {
                densityInput.value = DENSITIES[selectedType];
                densityInput.readOnly = true;
            } else {
                densityInput.readOnly = false;
                densityInput.value = '1.000';
            }
        }

        function addIngredient() {
            const ingredientsDiv = document.getElementById('ingredients');
            const newIngredient = document.createElement('div');
            newIngredient.className = 'ingredient-row';
            newIngredient.innerHTML = `
                <div class="form-group">
                    <label>Nom de l'ar√¥me</label>
                    <input type="text" class="ingredient-name" placeholder="Ex: Fraise, Vanille, Menthe..." required>
                </div>
                <div class="form-group">
                    <label>Pourcentage (%)</label>
                    <input type="number" class="ingredient-percentage" step="0.1" min="0" max="100" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select class="ingredient-type" onchange="updateDensity(this)">
                        <option value="arome" selected>Ar√¥me (PG)</option>
                        <option value="vg">Base VG</option>
                        <option value="pg">Base PG</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Densit√© (g/ml)</label>
                    <input type="number" class="ingredient-density" step="0.001" min="0" value="1.036" readonly>
                </div>
                <button type="button" class="btn btn-danger" onclick="removeIngredient(this)">√ó</button>
            `;
            ingredientsDiv.appendChild(newIngredient);
        }

        function removeIngredient(button) {
            const ingredientRows = document.querySelectorAll('.ingredient-row');
            if (ingredientRows.length > 1) {
                button.parentElement.remove();
            }
        }

        function calculateRecipe() {
            const targetVolume = parseFloat(document.getElementById('targetVolume').value) || 0;
            const desiredNicotine = parseFloat(document.getElementById('desiredNicotine').value) || 0;
            const nicotineStrength = parseFloat(document.getElementById('nicotineStrength').value) || 0;
            
            if (targetVolume <= 0) {
                alert('Veuillez entrer un volume cible valide');
                return;
            }

            // Calculer la quantit√© de nicotine n√©cessaire
            const nicotineNeeded = nicotineStrength > 0 ? (desiredNicotine * targetVolume) / nicotineStrength : 0;
            const nicotinePercentage = (nicotineNeeded / targetVolume) * 100;

            // R√©cup√©rer les ar√¥mes
            const ingredients = [];
            const ingredientRows = document.querySelectorAll('.ingredient-row');
            let totalPercentage = nicotinePercentage;

            ingredientRows.forEach(row => {
                const name = row.querySelector('.ingredient-name').value.trim();
                const percentage = parseFloat(row.querySelector('.ingredient-percentage').value) || 0;
                const type = row.querySelector('.ingredient-type').value;
                const density = parseFloat(row.querySelector('.ingredient-density').value) || 1;
                
                if (name && percentage > 0) {
                    ingredients.push({ name, percentage, density, type });
                    totalPercentage += percentage;
                }
            });

            // Calculer le pourcentage de base VG n√©cessaire
            const baseVGPercentage = Math.max(0, 100 - totalPercentage);
            const baseVGVolume = (baseVGPercentage / 100) * targetVolume;

            // V√©rifier que le total ne d√©passe pas 100%
            const totalUsedPercentage = nicotinePercentage + ingredients.reduce((sum, ing) => sum + ing.percentage, 0);
            if (totalUsedPercentage > 100) {
                alert(`Attention: Le total des pourcentages (${totalUsedPercentage.toFixed(1)}%) d√©passe 100%`);
                return;
            }

            // Calculer les quantit√©s
            const results = [];
            let totalWeight = 0;

            // Ajouter la Nicotine PG
            if (nicotineNeeded > 0) {
                const nicotineWeight = nicotineNeeded * DENSITIES.nicotine;
                results.push({
                    name: 'Nicotine (PG)',
                    volume: nicotineNeeded,
                    weight: nicotineWeight,
                    percentage: nicotinePercentage,
                    type: 'nicotine'
                });
                totalWeight += nicotineWeight;
            }

            // Ajouter les ar√¥mes
            ingredients.forEach(ingredient => {
                const volume = (ingredient.percentage / 100) * targetVolume;
                const weight = volume * ingredient.density;
                results.push({
                    name: ingredient.name,
                    volume: volume,
                    weight: weight,
                    percentage: ingredient.percentage,
                    type: ingredient.type
                });
                totalWeight += weight;
            });

            // Ajouter la base VG neutre
            if (baseVGPercentage > 0) {
                const baseVGWeight = baseVGVolume * DENSITIES.vg;
                results.push({
                    name: 'Base VG Neutre',
                    volume: baseVGVolume,
                    weight: baseVGWeight,
                    percentage: baseVGPercentage,
                    type: 'base'
                });
                totalWeight += baseVGWeight;
            }

            // Afficher les r√©sultats
            displayCalculationResults(results, totalWeight, targetVolume, {
                nicotineUsed: nicotineNeeded,
                baseVGUsed: baseVGVolume,
                aromesTotal: ingredients.reduce((sum, ing) => sum + (ing.percentage / 100) * targetVolume, 0)
            });
        }

        function displayCalculationResults(results, totalWeight, targetVolume, summary) {
            const resultsDiv = document.getElementById('calculationResults');
            
            let html = `
                <div class="calculation-results">
                    <h3>üìä R√©sultats du calcul</h3>
                    
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="value">${targetVolume.toFixed(1)}</div>
                            <div class="label">Volume total (ml)</div>
                        </div>
                        <div class="result-item">
                            <div class="value">${totalWeight.toFixed(2)}</div>
                            <div class="label">Poids total (g)</div>
                        </div>
                        <div class="result-item">
                            <div class="value">${summary.nicotineUsed.toFixed(2)}</div>
                            <div class="label">Nicotine (ml)</div>
                        </div>
                        <div class="result-item">
                            <div class="value">${summary.baseVGUsed.toFixed(2)}</div>
                            <div class="label">Base VG neutre (ml)</div>
                        </div>
                    </div>
                    
                    <h4 style="margin: 25px 0 15px 0; color: #388e3c;">üß™ Recette d√©taill√©e par ordre d'ajout :</h4>
            `;

            // Grouper et ordonner les r√©sultats
            const orderedResults = [];
            
            // 1. Nicotine en premier
            results.filter(r => r.type === 'nicotine').forEach(result => orderedResults.push(result));
            
            // 2. Ar√¥mes ensuite
            results.filter(r => r.type === 'arome' || (!r.type && r.name !== 'Base VG Neutre')).forEach(result => orderedResults.push(result));
            
            // 3. Base VG en dernier
            results.filter(r => r.type === 'base' || r.name === 'Base VG Neutre').forEach(result => orderedResults.push(result));

            orderedResults.forEach((result) => {
                const bgColor = result.type === 'nicotine' ? 'rgba(255, 193, 7, 0.2)' : 
                              result.type === 'base' ? 'rgba(76, 175, 80, 0.2)' : 
                              'rgba(102, 126, 234, 0.2)';
                
                const icon = result.type === 'nicotine' ? '‚ö†Ô∏è' : 
                           result.type === 'base' ? 'üè∫' : 'üçì';
                
                html += `
                    <div style="background: ${bgColor}; padding: 15px; margin: 8px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid ${result.type === 'nicotine' ? '#ffc107' : result.type === 'base' ? '#4caf50' : '#667eea'};">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${icon}</span>
                            <div>
                                <strong>${result.name}</strong>
                                <div style="font-size: 0.9em; color: #666;">${result.percentage.toFixed(1)}% du m√©lange</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.1em; font-weight: bold; color: #333;">${result.volume.toFixed(2)} ml</div>
                            <div style="font-size: 0.9em; color: #666;">${result.weight.toFixed(2)} g</div>
                        </div>
                    </div>
                `;
            });

            html += `
                    <div style="background: rgba(102, 126, 234, 0.1); padding: 20px; border-radius: 15px; margin-top: 20px;">
                        <h4 style="margin-bottom: 15px; color: #667eea;">üìù R√©sum√© :</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; text-align: center;">
                            <div>
                                <div style="font-weight: bold; color: #ffc107;">${summary.nicotineUsed.toFixed(1)} ml</div>
                                <div style="font-size: 0.9em; color: #666;">Nicotine</div>
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #667eea;">${summary.aromesTotal.toFixed(1)} ml</div>
                                <div style="font-size: 0.9em; color: #666;">Ar√¥mes total</div>
                            </div>
                            <div>
                                <div style="font-weight: bold; color: #4caf50;">${summary.baseVGUsed.toFixed(1)} ml</div>
                                <div style="font-size: 0.9em; color: #666;">Base VG neutre</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            resultsDiv.innerHTML = html;
        }

        function saveRecipe(event) {
            event.preventDefault();
            
            const name = document.getElementById('recipeName').value.trim();
            const description = document.getElementById('recipeDescription').value.trim();
            const desiredNicotine = parseFloat(document.getElementById('desiredNicotine').value) || 0;
            const nicotineStrength = parseFloat(document.getElementById('nicotineStrength').value) || 0;
            const targetVolume = parseFloat(document.getElementById('targetVolume').value) || 0;

            if (!name) {
                alert('Veuillez entrer un nom pour la recette');
                return;
            }

            // R√©cup√©rer les ingr√©dients
            const ingredients = [];
            const ingredientRows = document.querySelectorAll('.ingredient-row');
            
            ingredientRows.forEach(row => {
                const ingredientName = row.querySelector('.ingredient-name').value.trim();
                const percentage = parseFloat(row.querySelector('.ingredient-percentage').value) || 0;
                const type = row.querySelector('.ingredient-type').value;
                const density = parseFloat(row.querySelector('.ingredient-density').value) || 1;
                
                if (ingredientName && percentage > 0) {
                    ingredients.push({ name: ingredientName, percentage, density, type });
                }
            });

            if (ingredients.length === 0) {
                alert('Veuillez ajouter au moins un ingr√©dient');
                return;
            }

            const recipe = {
                id: Date.now(),
                name,
                description,
                desiredNicotine,
                nicotineStrength,
                targetVolume,
                ingredients,
                createdAt: new Date().toISOString(),
                favorite: false
            };

            recipes.push(recipe);
            localStorage.setItem('eliquid-recipes', JSON.stringify(recipes));
            
            // R√©initialiser le formulaire
            document.getElementById('recipeForm').reset();
            document.getElementById('calculationResults').innerHTML = '';
            document.getElementById('targetVolume').value = '30';
            document.getElementById('desiredNicotine').value = '3';
            document.getElementById('nicotineStrength').value = '20';
            
            // R√©initialiser les ingr√©dients
            resetIngredients();

            displayRecipes();
            alert('Recette sauvegard√©e avec succ√®s!');
        }

        function resetIngredients() {
            const ingredientsDiv = document.getElementById('ingredients');
            ingredientsDiv.innerHTML = `
                <div class="ingredient-row">
                    <div class="form-group">
                        <label>Nom de l'ar√¥me</label>
                        <input type="text" class="ingredient-name" placeholder="Ex: Fraise, Vanille, Menthe..." required>
                    </div>
                    <div class="form-group">
                        <label>Pourcentage (%)</label>
                        <input type="number" class="ingredient-percentage" step="0.1" min="0" max="100" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select class="ingredient-type" onchange="updateDensity(this)">
                            <option value="arome" selected>Ar√¥me (PG)</option>
                            <option value="vg">Base VG</option>
                            <option value="pg">Base PG</option>
                            <option value="autre">Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Densit√© (g/ml)</label>
                        <input type="number" class="ingredient-density" step="0.001" min="0" value="1.036" readonly>
                    </div>
                    <button type="button" class="btn btn-danger" onclick="removeIngredient(this)">√ó</button>
                </div>
            `;
        }

        function displayRecipes() {
            const searchTerm = document.getElementById('searchRecipes').value.toLowerCase();
            let filteredRecipes = recipes;

            // Filtrer par recherche
            if (searchTerm) {
                filteredRecipes = recipes.filter(recipe => 
                    recipe.name.toLowerCase().includes(searchTerm) ||
                    recipe.description.toLowerCase().includes(searchTerm) ||
                    recipe.ingredients.some(ing => ing.name.toLowerCase().includes(searchTerm))
                );
            }

            // Filtrer par cat√©gorie
            if (currentFilter === 'recent') {
                filteredRecipes = filteredRecipes.slice(-10).reverse();
            } else if (currentFilter === 'favorites') {
                filteredRecipes = filteredRecipes.filter(recipe => recipe.favorite);
            }

            const recipesDiv = document.getElementById('recipesList');
            
            if (filteredRecipes.length === 0) {
                recipesDiv.innerHTML = '<p style="text-align: center; color: #666; margin-top: 20px;">Aucune recette trouv√©e</p>';
                return;
            }

            let html = '';
            filteredRecipes.forEach(recipe => {
                const date = new Date(recipe.createdAt).toLocaleDateString('fr-FR');
                html += `
                    <div class="recipe-card">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <h3>${recipe.name}</h3>
                            <div>
                                <button class="btn btn-secondary" style="padding: 5px 10px; margin-right: 5px;" onclick="toggleFavorite(${recipe.id})">
                                    ${recipe.favorite ? '‚≠ê' : '‚òÜ'}
                                </button>
                                <button class="btn btn-danger" style="padding: 5px 10px;" onclick="deleteRecipe(${recipe.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        ${recipe.description ? `<p style="color: #666; margin-bottom: 15px; font-style: italic;">${recipe.description}</p>` : ''}
                        
                        <div class="recipe-info">
                            <div><strong>Nicotine:</strong> ${recipe.desiredNicotine} mg/ml</div>
                            <div><strong>Volume:</strong> ${recipe.targetVolume} ml</div>
                            <div><strong>Base:</strong> ${recipe.nicotineStrength} mg/ml</div>
                            <div><strong>Cr√©√© le:</strong> ${date}</div>
                        </div>
                        
                        <div class="ingredients-list">
                            <h4>Ingr√©dients:</h4>
                            ${recipe.ingredients.map(ing => `
                                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                    <span>${ing.name}</span>
                                    <span>${ing.percentage}% (${ing.density} g/ml)</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="recipe-action-buttons">
                            <button class="btn btn-primary" onclick="loadRecipe(${recipe.id})">
                                üìù Charger cette recette
                            </button>
                            <button class="btn btn-warning" onclick="showAddToSteepModal(${recipe.id})">
                                üìÖ Ajouter au Steep
                            </button>
                        </div>
                    </div>
                `;
            });

            recipesDiv.innerHTML = html;
        }

        function showAddToSteepModal(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;

            selectedRecipeForSteep = recipe;
            
            // Pr√©remplir avec la date d'aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('steepDateChoice').value = today;
            document.getElementById('selectedRecipeName').textContent = recipe.name;
            
            // R√©initialiser la s√©lection
            document.querySelectorAll('.steep-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector('.steep-option[data-days="14"]').classList.add('selected');
            selectedSteepDuration = 14;
            
            document.getElementById('addToSteepModal').style.display = 'block';
        }

        function loadRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            // Remplir les champs principaux
            document.getElementById('recipeName').value = recipe.name;
            document.getElementById('recipeDescription').value = recipe.description || '';
            document.getElementById('desiredNicotine').value = recipe.desiredNicotine;
            document.getElementById('nicotineStrength').value = recipe.nicotineStrength;
            document.getElementById('targetVolume').value = recipe.targetVolume;

            // Recharger les ingr√©dients
            const ingredientsDiv = document.getElementById('ingredients');
            ingredientsDiv.innerHTML = '';

            recipe.ingredients.forEach((ingredient) => {
                const ingredientRow = document.createElement('div');
                ingredientRow.className = 'ingredient-row';

                ingredientRow.innerHTML = `
                    <div class="form-group">
                        <label>Nom de l'ar√¥me</label>
                        <input type="text" class="ingredient-name" value="${ingredient.name}" required>
                    </div>
                    <div class="form-group">
                        <label>Pourcentage (%)</label>
                        <input type="number" class="ingredient-percentage" step="0.1" min="0" max="100" value="${ingredient.percentage}" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select class="ingredient-type" onchange="updateDensity(this)">
                            <option value="arome" ${ingredient.type === 'arome' ? 'selected' : ''}>Ar√¥me (PG)</option>
                            <option value="vg" ${ingredient.type === 'vg' ? 'selected' : ''}>Base VG</option>
                            <option value="pg" ${ingredient.type === 'pg' ? 'selected' : ''}>Base PG</option>
                            <option value="autre" ${ingredient.type === 'autre' ? 'selected' : ''}>Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Densit√© (g/ml)</label>
                        <input type="number" class="ingredient-density" step="0.001" min="0" value="${ingredient.density}" 
                            ${['arome', 'vg', 'pg'].includes(ingredient.type) ? 'readonly' : ''}>
                    </div>
                    <button type="button" class="btn btn-danger" onclick="removeIngredient(this)">√ó</button>
                `;

                ingredientsDiv.appendChild(ingredientRow);
            });

            // Scroll vers le formulaire
            document.querySelector('.main-grid').scrollIntoView({ behavior: 'smooth' });

            // Recalcul automatique
            calculateRecipe();
        }

        function exportRecipes() {
            const dataStr = JSON.stringify(recipes, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'recettes-eliquides.json';
            a.click();

            URL.revokeObjectURL(url);
        }

        function importRecipes(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) throw new Error("Format de fichier invalide");

                    if (confirm("Souhaitez-vous ajouter les recettes import√©es √† celles existantes ?\nCliquez sur 'Annuler' pour remplacer.")) {
                        recipes = recipes.concat(importedData);
                    } else {
                        recipes = importedData;
                    }

                    localStorage.setItem('eliquid-recipes', JSON.stringify(recipes));
                    displayRecipes();
                    alert("Recettes import√©es avec succ√®s !");
                } catch (err) {
                    alert("Erreur lors de l'import : " + err.message);
                }
            };
            reader.readAsText(file);
        }

        function toggleFavorite(id) {
            const recipe = recipes.find(r => r.id === id);
            if (recipe) {
                recipe.favorite = !recipe.favorite;
                localStorage.setItem('eliquid-recipes', JSON.stringify(recipes));
                displayRecipes();
            }
        }

        function deleteRecipe(id) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette recette ?')) {
                recipes = recipes.filter(r => r.id !== id);
                localStorage.setItem('eliquid-recipes', JSON.stringify(recipes));
                displayRecipes();
            }
        }

        function filterRecipes(filter, button) {
            currentFilter = filter;
            
            // Mettre √† jour l'apparence des boutons
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            
            displayRecipes();
        }

        // ===== GESTIONNAIRE DE STOCK =====

        function saveAroma(event) {
            event.preventDefault();
            
            const name = document.getElementById('aromaName').value.trim();
            const brand = document.getElementById('aromaBrand').value.trim();
            const type = document.getElementById('aromaType').value;
            const quantity = parseFloat(document.getElementById('aromaQuantity').value);

            if (!name || !brand || !type || quantity <= 0) {
                alert('Veuillez remplir tous les champs correctement');
                return;
            }

            // V√©rifier si l'ar√¥me existe d√©j√†
            const existingAroma = aromas.find(a => a.name.toLowerCase() === name.toLowerCase() && a.brand.toLowerCase() === brand.toLowerCase());
            
            if (existingAroma) {
                if (confirm(`L'ar√¥me "${name}" de ${brand} existe d√©j√†. Voulez-vous ajouter ${quantity}ml √† la quantit√© existante?`)) {
                    existingAroma.quantity += quantity;
                }
            } else {
                aromas.push({ 
                    id: Date.now(),
                    name, 
                    brand, 
                    type, 
                    quantity,
                    addedAt: new Date().toISOString()
                });
            }

            localStorage.setItem('aromas', JSON.stringify(aromas));
            document.getElementById('aromaForm').reset();
            renderStockTable();
            updateStockStats();
            alert('Ar√¥me ajout√© avec succ√®s!');
        }

        function renderStockTable() {
            const nameFilter = document.getElementById('searchName').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const table = document.getElementById('aromaTable');
            const noAromasDiv = document.getElementById('noAromas');

            let filteredAromas = aromas.filter(aroma => 
                aroma.name.toLowerCase().includes(nameFilter) && 
                (!typeFilter || aroma.type === typeFilter)
            );

            if (filteredAromas.length === 0) {
                table.innerHTML = '';
                noAromasDiv.style.display = 'block';
                return;
            }

            noAromasDiv.style.display = 'none';
            
            table.innerHTML = '';
            filteredAromas.forEach((aroma) => {
                const actualIndex = aromas.findIndex(a => a.id === aroma.id);
                const quantityClass = aroma.quantity >= 30 ? 'quantity-high' : 
                                     aroma.quantity >= 15 ? 'quantity-medium' : 'quantity-low';
                
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${aroma.name}</td>
                    <td>${aroma.brand}</td>
                    <td>${aroma.type}</td>
                    <td>${aroma.quantity.toFixed(1)} ml</td>
                    <td><span class="quantity-badge ${quantityClass}">${aroma.quantity >= 30 ? 'Stock OK' : aroma.quantity >= 15 ? 'Stock faible' : 'Critique'}</span></td>
                    <td>
                        <button class="btn btn-secondary" style="padding: 5px 10px; margin-right: 5px;" onclick="updateQuantity(${actualIndex})">üìù</button>
                        <button class="btn btn-danger" style="padding: 5px 10px;" onclick="deleteAroma(${actualIndex})">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        function updateQuantity(index) {
            const newQty = prompt(`Nouvelle quantit√© (ml) pour ${aromas[index].name} (${aromas[index].brand}):`, aromas[index].quantity);
            if (newQty !== null && !isNaN(newQty) && parseFloat(newQty) >= 0) {
                aromas[index].quantity = parseFloat(newQty);
                localStorage.setItem('aromas', JSON.stringify(aromas));
                renderStockTable();
                updateStockStats();
            }
        }

        function deleteAroma(index) {
            if (confirm(`√ätes-vous s√ªr de vouloir supprimer ${aromas[index].name} (${aromas[index].brand}) de votre stock?`)) {
                aromas.splice(index, 1);
                localStorage.setItem('aromas', JSON.stringify(aromas));
                renderStockTable();
                updateStockStats();
            }
        }

        function sortByQuantity() {
            aromas.sort((a, b) => sortAsc ? a.quantity - b.quantity : b.quantity - a.quantity);
            sortAsc = !sortAsc;
            localStorage.setItem('aromas', JSON.stringify(aromas));
            renderStockTable();
        }

        function updateStockStats() {
            const statsDiv = document.getElementById('stockStats');
            
            if (aromas.length === 0) {
                statsDiv.innerHTML = '<div class="result-item"><div class="value">0</div><div class="label">Ar√¥mes en stock</div></div>';
                return;
            }

            const totalAromas = aromas.length;
            const totalVolume = aromas.reduce((sum, aroma) => sum + aroma.quantity, 0);
            const criticalStock = aromas.filter(a => a.quantity < 15).length;
            const lowStock = aromas.filter(a => a.quantity >= 15 && a.quantity < 30).length;
            const goodStock = aromas.filter(a => a.quantity >= 30).length;

            statsDiv.innerHTML = `
                <div class="result-item">
                    <div class="value">${totalAromas}</div>
                    <div class="label">Ar√¥mes total</div>
                </div>
                <div class="result-item">
                    <div class="value">${totalVolume.toFixed(1)} ml</div>
                    <div class="label">Volume total</div>
                </div>
                <div class="result-item">
                    <div class="value" style="color: #e53e3e;">${criticalStock}</div>
                    <div class="label">Stock critique</div>
                </div>
                <div class="result-item">
                    <div class="value" style="color: #ed8936;">${lowStock}</div>
                    <div class="label">Stock faible</div>
                </div>
                <div class="result-item">
                    <div class="value" style="color: #48bb78;">${goodStock}</div>
                    <div class="label">Stock OK</div>
                </div>
            `;
        }

        function exportStockData() {
            const dataStr = JSON.stringify(aromas, null, 2);
            const blob = new Blob([dataStr], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'stock-aromes.json';
            a.click();

            URL.revokeObjectURL(url);
        }

        function importStockData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (!Array.isArray(importedData)) throw new Error("Format de fichier invalide");

                    // Ajouter des IDs si n√©cessaire
                    importedData.forEach(aroma => {
                        if (!aroma.id) {
                            aroma.id = Date.now() + Math.random();
                        }
                    });

                    if (confirm("Souhaitez-vous ajouter les ar√¥mes import√©s √† ceux existants ?\nCliquez sur 'Annuler' pour remplacer.")) {
                        aromas = aromas.concat(importedData);
                    } else {
                        aromas = importedData;
                    }

                    localStorage.setItem('aromas', JSON.stringify(aromas));
                    renderStockTable();
                    updateStockStats();
                    alert("Stock import√© avec succ√®s !");
                } catch (err) {
                    alert("Erreur lors de l'import : " + err.message);
                }
            };
            reader.readAsText(file);
        }

        // ===== STEEP TOOL =====

        function saveSteepRecipes() {
            try {
                localStorage.setItem('steepRecipes', JSON.stringify(steepRecipes));
            } catch (e) {
                console.error('Erreur lors de la sauvegarde:', e);
            }
        }

        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const currentMonth = document.getElementById('currentMonth');
            
            calendar.innerHTML = '';
            currentMonth.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;

            // Headers des jours
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = 0; i < 42; i++) {
                const day = new Date(startDate);
                day.setDate(startDate.getDate() + i);
                day.setHours(0, 0, 0, 0);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'day';
                
                if (day.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                if (day.getTime() === today.getTime()) {
                    dayElement.classList.add('today');
                }

                dayElement.innerHTML = `<div class="day-number">${day.getDate()}</div>`;

                // Ajouter les recettes pour ce jour
                steepRecipes.forEach(recipe => {
                    const recipeDate = new Date(recipe.createdDate);
                    recipeDate.setHours(0, 0, 0, 0);
                    
                    const readyDate = new Date(recipeDate);
                    readyDate.setDate(readyDate.getDate() + recipe.steepDuration);
                    readyDate.setHours(0, 0, 0, 0);
                    
                    // V√©rifier si c'est le jour de cr√©ation
                    if (day.getTime() === recipeDate.getTime()) {
                        const recipeElement = document.createElement('div');
                        recipeElement.className = 'recipe steeping';
                        recipeElement.textContent = `üß™ ${recipe.name}`;
                        recipeElement.title = `Cr√©√©e le ${recipeDate.toLocaleDateString('fr-FR')} - Pr√™te le ${readyDate.toLocaleDateString('fr-FR')}`;
                        recipeElement.onclick = (e) => {
                            e.stopPropagation();
                            showSteepRecipeDetails(recipe);
                        };
                        dayElement.appendChild(recipeElement);
                    }
                    
                    // V√©rifier si c'est le jour o√π elle est pr√™te
                    if (day.getTime() === readyDate.getTime()) {
                        const recipeElement = document.createElement('div');
                        recipeElement.className = 'recipe ready';
                        recipeElement.textContent = `‚úÖ ${recipe.name}`;
                        recipeElement.title = `Recette pr√™te √† vaper !`;
                        recipeElement.onclick = (e) => {
                            e.stopPropagation();
                            showSteepRecipeDetails(recipe);
                        };
                        dayElement.appendChild(recipeElement);
                    }
                });

                calendar.appendChild(dayElement);
            }
        }

        function showSteepRecipeDetails(recipe) {
            const recipeDate = new Date(recipe.createdDate);
            const readyDate = new Date(recipeDate);
            readyDate.setDate(readyDate.getDate() + recipe.steepDuration);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            readyDate.setHours(0, 0, 0, 0);
            
            const isReady = today >= readyDate;
            const daysLeft = Math.ceil((readyDate - today) / (1000 * 60 * 60 * 24));
            
            const modal = document.getElementById('steepModal');
            const modalContent = modal.querySelector('.modal-content');
            
            let statusText, statusIcon, statusClass;
            
            if (isReady) {
                statusText = 'Pr√™te √† vaper !';
                statusIcon = 'üéâ';
                statusClass = 'ready';
            } else if (daysLeft === 1) {
                statusText = 'Pr√™te demain !';
                statusIcon = '‚è∞';
                statusClass = 'steeping';
            } else {
                statusText = `${daysLeft} jour(s) restant(s)`;
                statusIcon = 'üïê';
                statusClass = 'steeping';
            }
            
            modalContent.innerHTML = `
                <span class="close" id="closeSteepModalBtn">&times;</span>
                <div class="recipe-details">
                    <h2>üß™ ${recipe.name}</h2>
                    <p><strong>Cr√©√©e le:</strong> ${recipeDate.toLocaleDateString('fr-FR')}</p>
                    <p><strong>Dur√©e de steep:</strong> ${recipe.steepDuration} jours</p>
                    <p><strong>Pr√™te le:</strong> ${readyDate.toLocaleDateString('fr-FR')}</p>
                    <div class="countdown ${statusClass}" style="background: ${isReady ? 'linear-gradient(135deg, #00b894, #00a085)' : 'linear-gradient(135deg, #fdcb6e, #e17055)'}; color: white; border-radius: 15px; padding: 15px; margin: 15px 0; text-align: center;">
                        <strong>${statusIcon} ${statusText}</strong>
                    </div>
                    <button class="delete-btn" onclick="deleteSteepRecipe('${recipe.id}')">üóëÔ∏è Supprimer</button>
                </div>
            `;
            
            // R√©attacher l'event listener pour fermer le modal
            document.getElementById('closeSteepModalBtn').onclick = closeSteepModal;
            
            modal.style.display = 'block';
        }

        function deleteSteepRecipe(recipeId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette recette?')) {
                steepRecipes = steepRecipes.filter(recipe => recipe.id !== recipeId);
                saveSteepRecipes();
                generateCalendar();
                closeSteepModal();
            }
        }

        function addSteepRecipe() {
            const nameElement = document.getElementById('steepRecipeName');
            const durationElement = document.getElementById('steepDuration');
            const dateElement = document.getElementById('steepRecipeDate');
            
            if (!nameElement || !durationElement || !dateElement) {
                alert('Erreur: √©l√©ments du formulaire non trouv√©s');
                return;
            }
            
            const name = nameElement.value.trim();
            const steepDuration = parseInt(durationElement.value);
            const createdDate = dateElement.value;
            
            if (!name) {
                alert('Veuillez entrer un nom pour la recette');
                return;
            }
            
            if (!createdDate) {
                alert('Veuillez s√©lectionner une date');
                return;
            }
            
            const recipe = {
                id: Date.now().toString(),
                name: name,
                steepDuration: steepDuration,
                createdDate: createdDate
            };
            
            steepRecipes.push(recipe);
            saveSteepRecipes();
            
            // Fermer le modal d'ajout
            closeSteepModal();
            
            // V√©rifier si on doit naviguer vers le bon mois
            const recipeDate = new Date(recipe.createdDate);
            
            // Naviguer vers le mois de cr√©ation si n√©cessaire
            if (recipeDate.getMonth() !== currentDate.getMonth() || recipeDate.getFullYear() !== currentDate.getFullYear()) {
                currentDate.setFullYear(recipeDate.getFullYear());
                currentDate.setMonth(recipeDate.getMonth());
            }
            
            // Mettre √† jour le calendrier
            generateCalendar();
            
            alert('Recette ajout√©e au calendrier avec succ√®s!');
        }

        function openSteepModal() {
            const modal = document.getElementById('steepModal');
            const modalContent = modal.querySelector('.modal-content');
            const today = new Date().toISOString().split('T')[0];
            
            modalContent.innerHTML = `
                <span class="close" id="closeSteepModalBtn">&times;</span>
                <h2>Nouvelle Recette E-Liquide pour Steep</h2>
                <div class="form-group">
                    <label for="steepRecipeName">Nom de la recette:</label>
                    <input type="text" id="steepRecipeName" placeholder="Ex: Vanille Custard" required>
                </div>
                <div class="form-group">
                    <label for="steepDuration">Dur√©e de steep (jours):</label>
                    <select id="steepDuration" required>
                        <option value="3">3 jours</option>
                        <option value="7">1 semaine</option>
                        <option value="14" selected>2 semaines</option>
                        <option value="21">3 semaines</option>
                        <option value="30">1 mois</option>
                        <option value="60">2 mois</option>
                        <option value="90">3 mois</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="steepRecipeDate">Date de cr√©ation:</label>
                    <input type="date" id="steepRecipeDate" value="${today}" required>
                </div>
                <button type="button" class="submit-btn" id="submitSteepRecipeBtn">üß™ Ajouter la Recette</button>
            `;
            
            // Attacher les event listeners
            document.getElementById('closeSteepModalBtn').onclick = closeSteepModal;
            document.getElementById('submitSteepRecipeBtn').onclick = addSteepRecipe;
            
            modal.style.display = 'block';
            
            // Focus sur le champ nom apr√®s un court d√©lai
            setTimeout(() => {
                const nameInput = document.getElementById('steepRecipeName');
                if (nameInput) {
                    nameInput.focus();
                }
            }, 100);
        }

        function closeSteepModal() {
            document.getElementById('steepModal').style.display = 'none';
        }

        function closeSteepRecipesList() {
            document.getElementById('steepRecipesListModal').style.display = 'none';
        }

        function closeAddToSteepModal() {
            document.getElementById('addToSteepModal').style.display = 'none';
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        function showAllSteepRecipes() {
            const modal = document.getElementById('steepRecipesListModal');
            const content = document.getElementById('steepRecipesListContent');
            
            if (steepRecipes.length === 0) {
                content.innerHTML = `
                    <div class="no-recipes">
                        <div class="no-recipes-icon">üß™</div>
                        <h2>Aucune recette pour le moment</h2>
                        <p>Commencez par ajouter votre premi√®re recette d'e-liquide !</p>
                        <button class="submit-btn" onclick="closeSteepRecipesList(); openSteepModal();">+ Ajouter ma premi√®re recette</button>
                    </div>
                `;
                modal.style.display = 'block';
                return;
            }

            // Trier les recettes
            const sortedRecipes = [...steepRecipes].sort((a, b) => {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                const aDate = new Date(a.createdDate);
                const aReadyDate = new Date(aDate);
                aReadyDate.setDate(aReadyDate.getDate() + a.steepDuration);
                aReadyDate.setHours(0, 0, 0, 0);
                
                const bDate = new Date(b.createdDate);
                const bReadyDate = new Date(bDate);
                bReadyDate.setDate(bReadyDate.getDate() + b.steepDuration);
                bReadyDate.setHours(0, 0, 0, 0);
                
                const aReady = today >= aReadyDate;
                const bReady = today >= bReadyDate;
                
                if (aReady && !bReady) return -1;
                if (!aReady && bReady) return 1;
                
                return new Date(b.createdDate) - new Date(a.createdDate);
            });

            const readyCount = sortedRecipes.filter(recipe => {
                const createdDate = new Date(recipe.createdDate);
                const readyDate = new Date(createdDate);
                readyDate.setDate(readyDate.getDate() + recipe.steepDuration);
                readyDate.setHours(0, 0, 0, 0);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                return today >= readyDate;
            }).length;

            content.innerHTML = `
                <h2>üìã Mes Recettes en Steep (${steepRecipes.length})</h2>
                <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(0, 184, 148, 0.1); border-radius: 10px;">
                    <strong>${readyCount} recette(s) pr√™te(s)</strong> ‚Ä¢ <strong>${steepRecipes.length - readyCount} en cours de steep</strong>
                </div>
                <div class="recipes-overview" id="steepRecipesContainer">
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="submit-btn" onclick="closeSteepRecipesList(); openSteepModal();">+ Ajouter une nouvelle recette</button>
                </div>
            `;

            const recipesContainer = document.getElementById('steepRecipesContainer');
            
            sortedRecipes.forEach((recipe) => {
                const createdDate = new Date(recipe.createdDate);
                const readyDate = new Date(createdDate);
                readyDate.setDate(readyDate.getDate() + recipe.steepDuration);
                
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                readyDate.setHours(0, 0, 0, 0);
                
                const isReady = today >= readyDate;
                const totalDays = recipe.steepDuration;
                const daysPassed = Math.max(0, Math.min(totalDays, Math.ceil((today - createdDate) / (1000 * 60 * 60 * 24))));
                const daysLeft = Math.max(0, Math.ceil((readyDate - today) / (1000 * 60 * 60 * 24)));
                const progressPercent = Math.min(100, (daysPassed / totalDays) * 100);
                
                let statusText, statusIcon;
                if (isReady) {
                    statusText = 'Pr√™te !';
                    statusIcon = '‚úÖ';
                } else if (daysLeft === 1) {
                    statusText = 'Demain !';
                    statusIcon = '‚è∞';
                } else {
                    statusText = `${daysLeft}j restant`;
                    statusIcon = 'üïê';
                }

                // Cr√©er l'√©l√©ment de la carte
                const recipeCard = document.createElement('div');
                recipeCard.className = `recipe-card ${isReady ? 'ready' : 'steeping'}`;
                recipeCard.innerHTML = `
                    <div class="recipe-card-header">
                        <h3 class="recipe-card-title">üß™ ${recipe.name}</h3>
                        <span class="recipe-status-badge ${isReady ? 'ready' : 'steeping'}">
                            ${statusIcon} ${statusText}
                        </span>
                    </div>
                    <div class="recipe-card-body">
                        <div class="recipe-info">
                            <span class="recipe-info-label">Date de cr√©ation</span>
                            <span class="recipe-info-value">${createdDate.toLocaleDateString('fr-FR')}</span>
                        </div>
                        <div class="recipe-info">
                            <span class="recipe-info-label">Pr√™te le</span>
                            <span class="recipe-info-value">${readyDate.toLocaleDateString('fr-FR')}</span>
                        </div>
                        <div class="recipe-info">
                            <span class="recipe-info-label">Dur√©e de steep</span>
                            <span class="recipe-info-value">${totalDays} jours</span>
                        </div>
                        <div class="recipe-info">
                            <span class="recipe-info-label">Progression</span>
                            <span class="recipe-info-value">${daysPassed}/${totalDays} jours (${Math.round(progressPercent)}%)</span>
                        </div>
                    </div>
                    <div class="recipe-progress">
                        <div class="progress-bar">
                            <div class="progress-fill ${isReady ? 'ready' : 'steeping'}" style="width: ${progressPercent}%"></div>
                        </div>
                        <div style="font-size: 0.9em; color: #6c757d;">
                            ${isReady ? 'üéâ Recette pr√™te √† vaper !' : `‚è±Ô∏è ${daysLeft} jour(s) de steep restant(s)`}
                        </div>
                    </div>
                    <div class="recipe-actions">
                    </div>
                `;

                // Cr√©er et ajouter les boutons avec des event listeners directs
                const actionsDiv = recipeCard.querySelector('.recipe-actions');
                
                // Bouton D√©tails
                const detailsBtn = document.createElement('button');
                detailsBtn.className = 'view-recipe-btn';
                detailsBtn.textContent = 'üëÅÔ∏è D√©tails';
                detailsBtn.addEventListener('click', function() {
                    closeSteepRecipesList();
                    showSteepRecipeDetails(recipe);
                });
                
                // Bouton Supprimer
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = 'üóëÔ∏è Supprimer';
                deleteBtn.addEventListener('click', function() {
                    if (confirm(`√ätes-vous s√ªr de vouloir supprimer la recette "${recipe.name}" ?`)) {
                        steepRecipes = steepRecipes.filter(r => r.id !== recipe.id);
                        saveSteepRecipes();
                        generateCalendar();
                        // Rafra√Æchir la vue
                        showAllSteepRecipes();
                    }
                });
                
                actionsDiv.appendChild(detailsBtn);
                actionsDiv.appendChild(deleteBtn);
                
                recipesContainer.appendChild(recipeCard);
            });
            
            modal.style.display = 'block';
        }

        // Fonctions pour le modal d'ajout au steep depuis une recette
        function setupSteepOptionsListeners() {
            document.querySelectorAll('.steep-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.steep-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedSteepDuration = parseInt(this.dataset.days);
                });
            });
        }

        function confirmAddToSteep() {
            if (!selectedRecipeForSteep) return;

            const createdDate = document.getElementById('steepDateChoice').value;
            if (!createdDate) {
                alert('Veuillez s√©lectionner une date');
                return;
            }

            const steepRecipe = {
                id: Date.now().toString(),
                name: selectedRecipeForSteep.name,
                steepDuration: selectedSteepDuration,
                createdDate: createdDate,
                originalRecipeId: selectedRecipeForSteep.id
            };

            steepRecipes.push(steepRecipe);
            saveSteepRecipes();

            closeAddToSteepModal();

            // Naviguer vers l'onglet steep
            document.querySelector('.tab[onclick*="steep"]').click();

            // V√©rifier si on doit naviguer vers le bon mois
            const recipeDate = new Date(steepRecipe.createdDate);
            if (recipeDate.getMonth() !== currentDate.getMonth() || recipeDate.getFullYear() !== currentDate.getFullYear()) {
                currentDate.setFullYear(recipeDate.getFullYear());
                currentDate.setMonth(recipeDate.getMonth());
            }

            generateCalendar();
            alert(`Recette "${selectedRecipeForSteep.name}" ajout√©e au calendrier de steep avec succ√®s!`);
        }

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', function() {
            displayRecipes();
            renderStockTable();
            updateStockStats();
            generateCalendar();
            
            // Event listeners pour les recettes
            document.getElementById('recipeForm').addEventListener('submit', saveRecipe);
            document.getElementById('searchRecipes').addEventListener('input', displayRecipes);
            
            // Event listeners pour le stock
            document.getElementById('aromaForm').addEventListener('submit', saveAroma);
            document.getElementById('searchName').addEventListener('input', renderStockTable);
            document.getElementById('filterType').addEventListener('change', renderStockTable);
            
            // Event listeners pour le steep tool
            document.getElementById('prevBtn').onclick = previousMonth;
            document.getElementById('nextBtn').onclick = nextMonth;
            document.getElementById('addSteepRecipeBtn').onclick = openSteepModal;
            document.getElementById('viewSteepRecipesBtn').onclick = showAllSteepRecipes;
            document.getElementById('closeSteepModalBtn').onclick = closeSteepModal;
            document.getElementById('closeSteepRecipesModalBtn').onclick = closeSteepRecipesList;
            document.getElementById('closeAddToSteepModalBtn').onclick = closeAddToSteepModal;
            document.getElementById('confirmAddToSteepBtn').onclick = confirmAddToSteep;
            
            // Setup steep options listeners
            setupSteepOptionsListeners();
            
            // Fermer les modals en cliquant √† l'ext√©rieur
            window.onclick = function(event) {
                const steepModal = document.getElementById('steepModal');
                const steepRecipesListModal = document.getElementById('steepRecipesListModal');
                const addToSteepModal = document.getElementById('addToSteepModal');
                
                if (event.target === steepModal) {
                    closeSteepModal();
                }
                if (event.target === steepRecipesListModal) {
                    closeSteepRecipesList();
                }
                if (event.target === addToSteepModal) {
                    closeAddToSteepModal();
                }
            };
            
            // Gestion de la touche Entr√©e pour les modals de steep
            document.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    const steepModal = document.getElementById('steepModal');
                    const addToSteepModal = document.getElementById('addToSteepModal');
                    
                    if (steepModal.style.display === 'block') {
                        const submitBtn = document.getElementById('submitSteepRecipeBtn');
                        if (submitBtn && submitBtn.textContent.includes('Ajouter')) {
                            addSteepRecipe();
                        }
                    }
                    
                    if (addToSteepModal.style.display === 'block') {
                        confirmAddToSteep();
                    }
                }
            });
        });
    </script>
</body>
</html>